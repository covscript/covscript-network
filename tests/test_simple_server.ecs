import netutils

var config = {
    "keep_alive_timeout": 10000,
    "max_keep_alive": 200,
    "worker_count": 4,
    "wwwroot": "./wwwroot",
    "port": 8080
} as hash_map

netutils.log_stream = iostream.ofstream("./netutils.log")

var server = (new netutils.http_server)
    .set_wwwroot(config.wwwroot)
    .set_config(config)
    .bind_code(netutils.state_codes.code_404, "./404.html")
    .bind_func("/test", [](server, session, data){
        # Simple ECHO Server
        if session.method != "POST"
            session.send_response(netutils.state_codes.code_400, "Please use POST method. Data = " + data, "text/plain")
        else
            session.send_response(netutils.state_codes.code_200, data, "text/plain")
        end
    })
    .listen(config.port)

system.out.println("Starting HTTP server at http://" + netutils.local_addr() + ":" + config.port + "/")
server.run()
